@model List<ProjectTest1.Models.ProductModel>

@{
    ViewData["Title"] = "Quản lý sản phẩm";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">📦 Quản lý sản phẩm</h2>
        <button class="btn btn-success" onclick="product.openCreateModal()">Thêm mới</button>

    </div>

    <!-- 🔍 FORM TÌM KIẾM -->
    <form id="filterForm" method="get" class="d-flex flex-wrap align-items-end gap-3">

        <div class="form-group" style="min-width:180px;">
            <label class="form-label mb-1 small">Tên SP</label>
            <input type="text" name="keySearch" class="form-control form-control-sm" placeholder="Tên..." />
        </div>

        <div class="form-group" style="min-width:160px;">
            <label class="form-label mb-1 small">Từ ngày</label>
            <input type="date" name="fromDate" class="form-control form-control-sm" />
        </div>

        <div class="form-group" style="min-width:160px;">
            <label class="form-label mb-1 small">Đến ngày</label>
            <input type="date" name="toDate" class="form-control form-control-sm" />
        </div>

        <div class="form-group flex-fill" style="min-width:250px;">
            <label class="form-label mb-1 small">Phạm vi giá</label>
            <div id="priceRangeSlider" style="max-width: 400px; margin: auto;"></div>
            <small class="d-block mt-1 text-center text-muted">
                Giá: <span id="minPriceValue" class="fw-bold">0 VNĐ</span> - <span id="maxPriceValue" class="fw-bold">10,000,000 VNĐ</span>
            </small>
            <input type="hidden" name="minPrice" id="minPriceHidden" value="0" />
            <input type="hidden" name="maxPrice" id="maxPriceHidden" value="10000000" />
        </div>

        <div class="form-group mb-3">
            <button type="submit" class="btn btn-success px-4 btn-sm" onclick="product.loadData(1)">
                🔍 Tìm
            </button>
        </div>
    </form>



    <!-- 🎛️ NÚT HÀNH ĐỘNG -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="fw-bold">🧾 Danh sách sản phẩm</div>
        <div class="d-flex gap-2">
            <button type="submit"
                    class="btn btn-sm btn-danger"
                    onclick="product.deleteAll()">
                🗑️ Xoá nhiều
            </button>
        </div>
    </div>

    <!-- 📋 BẢNG DỮ LIỆU -->
    <div class="table-responsive shadow-sm border rounded" id="gridData">
        <!-- Dữ liệu sẽ được load bằng Ajax -->
    </div>
</div>
<!-- Spinner ở ngoài modal -->
<div id="loadingOverlay" style="
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(255,255,255,0.7);
    z-index: 10550;
    justify-content: center;
    align-items: center;
">
    <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<div id="modal-placeholder"></div>

@section Scripts {
    <script src="~/js/Product.js"></script>
}
<script>
    function formatVND(number) {
        return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " VNĐ";
    }

    document.addEventListener("DOMContentLoaded", function() {
        var slider = document.getElementById("priceRangeSlider");
        noUiSlider.create(slider, {
            start: [0, 10000000],
            connect: true,
            range: {
                'min': 0,
                'max': 10000000
            },
            step: 10000,
            format: {
                to: function(value) {
                    return Math.round(value);
                },
                from: function(value) {
                    return Number(value);
                }
            }
        });

        slider.noUiSlider.on("update", function(values) {
            document.getElementById("minPriceValue").textContent = formatVND(values[0]);
            document.getElementById("maxPriceValue").textContent = formatVND(values[1]);
            document.getElementById("minPriceHidden").value = values[0];
            document.getElementById("maxPriceHidden").value = values[1];
        });
    });
</script>